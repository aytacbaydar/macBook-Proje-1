
<div class="konu-anlatim-container">
  <h2 class="baslik">Konu Anlatım Sayfası</h2>

  <div class="kontrol-paneli">
    <div class="pdf-secici">
      <label for="pdf-yukle" class="btn-sec">PDF Seç</label>
      <input type="file" id="pdf-yukle" (change)="pdfSecildi($event)" accept="application/pdf" class="gizli">
      <span *ngIf="secilenPDF" class="secilen-dosya">{{ secilenPDF }}</span>
    </div>

    <div *ngIf="pdfYuklendi" class="cizim-araclari">
      <button (click)="toggleCizim()" class="btn-arac">
        {{ cizilebilir ? 'Çizimi Durdur' : 'Çizimi Başlat' }}
      </button>
      <button (click)="temizleCanvas()" class="btn-arac">Temizle</button>
      <button (click)="silgiModunuAc()" class="btn-arac" [class.aktif]="silgiModu">
        <span class="ikon-silgi">🧹</span> Silgi
      </button>
      <button (click)="kalemModunuAc()" class="btn-arac" [class.aktif]="!silgiModu">
        <span class="ikon-kalem">✏️</span> Kalem
      </button>

      <div class="renk-secici">
        <label for="renk">Renk:</label>
        <input type="color" id="renk" [value]="kalemRengi" (change)="renkDegistir($event)">
      </div>

      <div class="kalinlik-secici">
        <label for="kalinlik">Kalınlık:</label>
        <input type="range" id="kalinlik" min="1" max="20" [value]="kalemKalinligi" (change)="kalinlikDegistir($event)">
      </div>
    </div>

    <div *ngIf="pdfYuklendi" class="sayfa-kontrolleri">
      <button (click)="oncekiSayfa()" [disabled]="currentPage === 1" class="btn-sayfa">Önceki Sayfa</button>
      <span class="sayfa-bilgisi">{{ currentPage }} / {{ totalPages }}</span>
      <button (click)="sonrakiSayfa()" [disabled]="currentPage === totalPages" class="btn-sayfa">Sonraki Sayfa</button>
      <button (click)="toggleTamEkran()" class="btn-tam-ekran">
        <span>{{ tamEkranModu ? 'Tam Ekrandan Çık' : 'Tam Ekran' }}</span>
        <i class="ekran-ikonu">{{ tamEkranModu ? '⬇️' : '⬆️' }}</i>
      </button>
      <button (click)="pdfBuyut()" class="btn-buyut">
        <span>Büyüt</span>
        <i class="zoom-ikonu">🔍+</i>
      </button>
    </div>

    <div *ngIf="pdfYuklendi" class="kaydetme-bolumu">
      <select [(ngModel)]="secilenGrup" class="grup-secici">
        <option value="" disabled selected>Öğrenci Grubu Seçin</option>
        <option *ngFor="let grup of ogrenciGruplari" [value]="grup">{{ grup }}</option>
      </select>
      <button (click)="kaydet()" [disabled]="!secilenGrup || kaydetmeIsleminde" class="btn-kaydet">
        {{ kaydetmeIsleminde ? 'Kaydediliyor...' : 'Kaydet' }}
      </button>
    </div>
  </div>

  <div class="calisma-alani">
    <div *ngIf="!pdfYuklendi && !dosyaBoyutuUyarisi" class="pdf-yukle-mesaj">
      Lütfen bir PDF dosyası seçin
    </div>

    <div *ngIf="dosyaBoyutuUyarisi" class="buyuk-dosya-uyarisi">
      <p>Seçtiğiniz dosya 16 MB'tan büyük. Büyük dosyalar yavaş yüklenebilir veya performans sorunlarına neden olabilir.</p>
      <p>Öneriler:</p>
      <ul>
        <li>Daha küçük bir PDF dosyası kullanın</li>
        <li>PDF'i daha düşük çözünürlükte kaydederek sıkıştırın</li>
        <li>PDF'i bölümlere ayırıp daha küçük dosyalar halinde yükleyin</li>
      </ul>
      <button (click)="optimizeEtVeYukle()" class="btn-optimize">Optimize Et ve Yükle</button>
    </div>

    <div *ngIf="pdfYuklendi" class="pdf-container" [class.tam-ekran]="tamEkranModu">
      <!-- Önce PDF görüntüleyici -->
      <div class="pdf-viewer-wrapper">
        <pdf-viewer
          [src]="pdfSrc"
          [page]="currentPage"
          [render-text]="true"
          [original-size]="false"
          [fit-to-page]="true"
          [show-all]="false"
          [autoresize]="true"
          [show-borders]="false"
          [external-link-target]="'blank'"
          (after-load-complete)="pdfYuklendiHandler($event)"
        ></pdf-viewer>
      </div>

      <!-- Sonra Canvas container -->
      <div class="canvas-container" 
           [class.kalem-aktif]="!silgiModu && cizilebilir"
           [class.silgi-aktif]="silgiModu && cizilebilir">
        <canvas #canvas></canvas>
      </div>
    </div>
  </div>
</div>

<style>
.pdf-container {
  position: relative;
  width: 100%;
  height: calc(100vh - 200px);
  margin: 0 auto;
  border: 1px solid #ccc;
  border-radius: 5px;
  overflow: hidden;
  transition: all 0.3s ease;
  background-color: #f0f0f0;
}

.pdf-container.tam-ekran {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  z-index: 1000;
  margin: 0;
  border: none;
  border-radius: 0;
}

.canvas-container {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 10;
  pointer-events: auto !important;
}

.canvas-container canvas {
  width: 100% !important;
  height: 100% !important;
  pointer-events: auto !important;
}

.kalem-aktif {
  cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="%23000000" d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>') 0 24, auto;
}

.silgi-aktif {
  cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="%23000000" d="M15.14 3c-.51 0-1.02.2-1.41.59L2.59 14.73c-.78.77-.78 2.04 0 2.83L5.03 20h7.94l-1.72-1.72-4.47.01-1.41-1.41 8.84-8.84 1.42 1.41 1.72-1.72-5.47-5.47c-.39-.39-.9-.59-1.41-.59M21 19.5c0 .83-.67 1.5-1.5 1.5h-5.25l1.73-1.73 3.52-.01V19.5z"/></svg>') 0 24, auto;
}

/* PDF viewer görünürlüğünü artırma */
::ng-deep .ng2-pdf-viewer-container {
  background-color: #f9f9f9 !important;
  border: 1px solid #ddd !important;
}

/* PDF görüntüleme için özel stiller */
::ng-deep pdf-viewer {
  display: block !important;
  height: 100% !important;
  width: 100% !important;
  background-color: #fff !important;
}
</style>
